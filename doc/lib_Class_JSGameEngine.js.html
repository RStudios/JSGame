<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/Class/JSGameEngine.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/Class/JSGameEngine.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file JSGameEngine class.
 * @package jsgame
 * @copyright (c) 2016, Thomas Alrek
 * @author Thomas Alrek &lt;thomas@alrek.no>
 */

"use strict";

/**
 * @class JSGameEngine
 * Creates a new instance of JSGameEngine.
 * &lt;p>&lt;i>This is the "entrypoint" for all JSGame projects&lt;/i>&lt;/p>
 *
 * @constructor
 * @param {options} options An object containing construct options
 * @property {Object&lt;GameObject>} components An object containing attached GameObjects
 * @property {HTMLCanvasElement} canvas The canvas to draw to. If no canvas is provided, a new canvas will automatically be inserted into the DOM
 * @property {number} width The width of the canvas (optional)
 * @property {number} height The height of the canvas (optional)
 * @property {Time} time The globally shared instance of Time
 * @property {CanvasRenderingContext2D} ctx The rendering context
 */
function JSGameEngine(options){
    var self = this;
    this.components = {};
    this.canvas = document.createElement("canvas");
    this.width = 0;
    this.height = 0;
    this.time = new Time();
    this.__construct(this, options);
    this.ctx = this.canvas.getContext('2d');
    this.canvas.width = this.width || window.innerWidth;
    this.canvas.height = this.height || window.innerHeight;
    this.width = this.canvas.width;
    this.height = this.canvas.height;
    
    Time = this.time;
    
    /**
     * Renders all enabled GameObjects in the components property.
     * &lt;p>&lt;i>This method is called automatically every frame. It automatically calls each attached GameObjects __update method&lt;/i>&lt;/p>
     * 
     * @method
     * @name JSGameEngine#update
     * @param {number} delta The timestamp at the start of the frame
     */
    this.update = function(delta){
        requestAnimationFrame(self.update);
        self.time.update(delta);
        var canvas = self.canvas;
        var ctx = self.ctx;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        var Time = self.time;
        for(var index in self.components){
            var gameObject = self.components[index];
            for(var component in gameObject.components){
                if(!gameObject.components[component].parent){
                    gameObject.components[component].parent = gameObject;
                }
            }
            if(!gameObject.enabled){
                continue;
            }
            if(gameObject.visible){
                ctx.save();
                var rotation = gameObject.transform.rotation;
                var position = gameObject.transform.position;
                ctx.translate(position.x + gameObject.width / 2, position.y + gameObject.height / 2);
                ctx.rotate((rotation * Math.PI) / 180);
                ctx.translate(Math.invert(position.x + gameObject.width / 2), Math.invert(position.y + gameObject.height / 2));
                for(var childComponent in gameObject.components){
                    if(gameObject.components[childComponent].enabled){
                        gameObject.components[childComponent].__update(self);
                    }
                }
                gameObject.__update(self);
                ctx.restore();
            }
        }
        self.fixedUpdate(delta);
    }
    
    /**
     * Calls __fixedUpdate on each enabled GameObject in the components property.
     * &lt;p>&lt;i>This method is called automatically every fixedUpdate tick which runs at a fixed rate of ~50 fps.&lt;/i>&lt;/p>
     * &lt;p>&lt;i>Fixed update should only be used for things that doesn't need to have an per frame accuracy&lt;/i>&lt;/p>
     * 
     * @method
     * @name JSGameEngine#fixedUpdate
     * @param {number} delta The timestamp at the start of the frame
     */
    this.fixedUpdate = function(delta){
        self.time.fixedUpdate(delta);
        var Time = self.time;
        for(var index in self.components){
            var gameObject = self.components[index];
            for(var component in gameObject.components){
                if(!gameObject.components[component].parent){
                    gameObject.components[component].parent = gameObject;
                }
            }
            if(!gameObject.enabled){
                continue;
            }
            for(var childComponent in gameObject.components){
                if(gameObject.components[childComponent].enabled){
                    gameObject.components[childComponent].__fixedUpdate(self);
                }
            }
            gameObject.__fixedUpdate(self);
        }
        /*
        setTimeout(function(){
            self.fixedUpdate(performance.now);
        }, Time.framerateToTime(50) * 1000);*/
    }
    
    /* init */
    requestAnimationFrame(this.update);
    //this.fixedUpdate(performance.now);
}

JSGameEngine.prototype = new Constructor();
JSGameEngine.prototype.constructor = JSGameEngine;

module.exports = JSGameEngine;

/**
 * Adds a GameObject as a component to JSGameEngine.components
 * &lt;p>&lt;i>Use this method to add elements to your game.&lt;/i>&lt;/p>
 * 
 * @method
 * @name JSGameEngine#addComponent
 * @param {Object} obj The GameObject to add.
 * @param {String} [id] An id to assign to the object. Must be unique. If none is specified, an UUID is generated
 * @throws {TypeError} If obj not is an instance of GameObject
 */</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AudioClip.html">AudioClip</a></li><li><a href="Background.html">Background</a></li><li><a href="Color.html">Color</a></li><li><a href="Component.html">Component</a></li><li><a href="Constructor.html">Constructor</a></li><li><a href="GameObject.html">GameObject</a></li><li><a href="Input.html">Input</a></li><li><a href="JSGameEngine.html">JSGameEngine</a></li><li><a href="Particle.html">Particle</a></li><li><a href="ParticleSystem.html">ParticleSystem</a></li><li><a href="Physics2D.html">Physics2D</a></li><li><a href="Script.html">Script</a></li><li><a href="Shadow.html">Shadow</a></li><li><a href="Sprite.html">Sprite</a></li><li><a href="Text.html">Text</a></li><li><a href="Time.html">Time</a></li><li><a href="Transform.html">Transform</a></li><li><a href="Vector2.html">Vector2</a></li></ul><h3>Namespaces</h3><ul><li><a href="options.html">options</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Jul 07 2016 22:43:28 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
